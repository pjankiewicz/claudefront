# Strategy Game - Real-Time Strategy with Type-Safe Architecture

A multiplayer-style strategy game where you compete against AI opponents to dominate the map. Built with Rust backend and TypeScript frontend with **complete type safety** from backend to frontend.

## ğŸ® Game Features

- **Real-time gameplay** with configurable tick rate (100ms default)
- **Procedural map generation** with 75 territories and varied terrain
- **8 AI opponents** with distinct personalities (Turtle, Aggressor, Balanced, Opportunist, Rusher)
- **Combat system** with terrain and building bonuses
- **Resource management** (population, gold, troops, workers)
- **Building system** (Cities, Defense Posts, Gold Mines)
- **WebSocket real-time communication**

## ğŸ—ï¸ Architecture Highlights

### Type-Safe Pipeline

```
Rust Types (utoipa)
    â†“
OpenAPI Specification
    â†“
TypeScript SDK (auto-generated)
    â†“
React Components
```

**Benefits:**
- âœ… Zero drift between frontend and backend
- âœ… All type errors caught at compile time
- âœ… Full IDE autocomplete
- âœ… Refactoring safety
- âœ… Self-documenting API

## ğŸš€ Quick Start

```bash
# 1. Generate TypeScript SDK from backend
make sdk

# 2. Run backend and frontend
make dev
```

Open:
- Frontend: http://localhost:5173
- Backend: http://localhost:3000
- API Docs: http://localhost:3000/swagger-ui

See [QUICKSTART.md](QUICKSTART.md) for detailed guide.

## ğŸ“ Project Structure

```
strategy_game/
â”œâ”€â”€ backend/              # Rust backend
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ types/       # utoipa-annotated types (source of truth)
â”‚   â”‚   â”œâ”€â”€ game/        # Game logic (state, combat, AI, map gen)
â”‚   â”‚   â”œâ”€â”€ websocket/   # WebSocket server
â”‚   â”‚   â””â”€â”€ main.rs      # Server entry point
â”‚   â””â”€â”€ openapi.json     # Generated OpenAPI spec
â”‚
â”œâ”€â”€ frontend/            # TypeScript/React frontend
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ api/        # AUTO-GENERATED SDK (types, models, services)
â”‚   â”‚   â””â”€â”€ client/     # WebSocket client (uses generated types)
â”‚   â””â”€â”€ package.json
â”‚
â”œâ”€â”€ docs/               # Documentation
â”‚   â””â”€â”€ brief_expanded.md  # Full game design document
â”‚
â”œâ”€â”€ Makefile            # Build automation
â”œâ”€â”€ QUICKSTART.md       # Getting started guide
â”œâ”€â”€ SDK_SUMMARY.md      # SDK architecture details
â””â”€â”€ README.md           # This file
```

## ğŸ› ï¸ Tech Stack

### Backend
- **Rust** - Systems programming language
- **Axum** - Web framework
- **Tokio** - Async runtime
- **utoipa** - OpenAPI generation from Rust types
- **Serde** - Serialization/deserialization
- **WebSockets** - Real-time communication

### Frontend
- **TypeScript** - Type-safe JavaScript
- **React** - UI library
- **Vite** - Build tool
- **openapi-typescript-codegen** - SDK generation

## ğŸ“š Documentation

- [QUICKSTART.md](QUICKSTART.md) - Get started in 5 minutes
- [backend/README.md](backend/README.md) - Backend architecture
- [frontend/SDK_README.md](frontend/SDK_README.md) - SDK usage guide
- [SDK_SUMMARY.md](SDK_SUMMARY.md) - Type safety pipeline details
- [docs/brief_expanded.md](docs/brief_expanded.md) - Complete game design

## ğŸ¯ Key Commands

```bash
# SDK Generation
make sdk              # Export OpenAPI + Generate TypeScript SDK
make export-openapi   # Export OpenAPI spec only
make generate-sdk     # Generate SDK from existing spec

# Development
make backend          # Run Rust backend
make frontend         # Run React frontend
make dev             # Run both in parallel

# Utilities
make help            # Show all commands
make clean           # Clean build artifacts
```

## ğŸ”§ SDK Usage Example

```typescript
import { useGameClient } from './client';

function Game() {
  const { client, gameState, isConnected } = useGameClient({
    autoConnect: true,
  });

  if (!isConnected) return <div>Connecting...</div>;

  return (
    <div>
      <button onClick={() => client?.attack(fromId, toId)}>
        Attack Territory
      </button>
      <div>Tick: {gameState?.tick}</div>
    </div>
  );
}
```

All types are auto-generated from backend - **zero manual type definitions!**

## ğŸ¨ Game Mechanics

### Resources
- **Population**: Grows 10/sec per territory + terrain bonuses
- **Gold**: Generated by workers (1 per 10 workers/sec)
- **Troops**: Used for attacking (configurable ratio)
- **Workers**: Generate gold (1 - troop ratio)

### Combat
- Attack adjacent territories
- Combat formula based on troop ratios
- Terrain bonuses (Mountains: +30% defense)
- Building bonuses (Defense Post: +20% defense)

### Buildings
- **City**: +25,000 max population (1000 gold)
- **Defense Post**: +20% defense (500 gold)
- **Gold Mine**: +50% gold generation (750 gold)

### AI Personalities
- **Turtle**: Defensive, economic focus
- **Aggressor**: Constant attacks, high troops
- **Balanced**: Adapts to situation
- **Opportunist**: Attacks weak targets
- **Rusher**: All-in aggression

## ğŸ§ª Development Workflow

### Backend Changes

```bash
# 1. Edit types in backend/src/types/
# 2. Verify compilation
cd backend && cargo check

# 3. Regenerate SDK
make sdk

# 4. Fix any TypeScript errors in frontend
```

TypeScript will show **exactly** what needs updating - no guessing!

## ğŸ¤ Contributing

1. Backend types are source of truth (`backend/src/types/`)
2. Never edit `frontend/src/api/` (auto-generated)
3. Custom logic goes in `frontend/src/client/`
4. Run `make sdk` after any backend type changes
5. Ensure all TypeScript errors are fixed before committing

## ğŸ“Š Project Stats

- **Backend**: ~2000 lines of Rust
- **Frontend SDK**: Auto-generated from backend
- **Game Loop**: 100ms tick rate (10 ticks/second)
- **AI Count**: 8 opponents with 5 personality types
- **Territories**: 50-100 (configurable)
- **Build Time**: <30s backend, <5s frontend

## ğŸ” Type Safety Guarantees

```typescript
// âŒ Compile error - invalid building type
client.buildStructure(id, 'invalid');

// âŒ Compile error - missing required field
const msg: ClientMessage = {
  type: 'attack',
  from: id,
  // Missing 'to' field
};

// âœ… Correct - fully typed
client.buildStructure(id, 'city');
client.attack(fromId, toId);
```

## ğŸ› Troubleshooting

**Cannot find module './api/models'**
```bash
make sdk  # Generate SDK first
```

**Port 3000 in use**
```bash
lsof -ti:3000 | xargs kill -9
```

**Types don't match backend**
```bash
make sdk  # Regenerate SDK
```

## ğŸ“ License

MIT

## ğŸ‰ Next Steps

1. âœ… Backend with game logic
2. âœ… OpenAPI generation
3. âœ… TypeScript SDK generation
4. âœ… WebSocket client
5. âœ… React hooks
6. ğŸš§ Build game UI
7. ğŸš§ Add map visualization
8. ğŸš§ Implement territory clicking
9. ğŸš§ Add game controls UI

**Ready to build the frontend!** See [QUICKSTART.md](QUICKSTART.md) to get started.
# claudefront
