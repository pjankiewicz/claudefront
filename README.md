# Strategy Game - Real-Time Strategy with Type-Safe Architecture

A multiplayer-style strategy game where you compete against AI opponents to dominate the map. Built with Rust backend and TypeScript frontend with **complete type safety** from backend to frontend.

## 🎮 Game Features

- **Real-time gameplay** with configurable tick rate (100ms default)
- **Procedural map generation** with 75 territories and varied terrain
- **8 AI opponents** with distinct personalities (Turtle, Aggressor, Balanced, Opportunist, Rusher)
- **Combat system** with terrain and building bonuses
- **Resource management** (population, gold, troops, workers)
- **Building system** (Cities, Defense Posts, Gold Mines)
- **WebSocket real-time communication**

## 🏗️ Architecture Highlights

### Type-Safe Pipeline

```
Rust Types (utoipa)
    ↓
OpenAPI Specification
    ↓
TypeScript SDK (auto-generated)
    ↓
React Components
```

**Benefits:**
- ✅ Zero drift between frontend and backend
- ✅ All type errors caught at compile time
- ✅ Full IDE autocomplete
- ✅ Refactoring safety
- ✅ Self-documenting API

## 🚀 Quick Start

```bash
# 1. Generate TypeScript SDK from backend
make sdk

# 2. Run backend and frontend
make dev
```

Open:
- Frontend: http://localhost:5173
- Backend: http://localhost:3000
- API Docs: http://localhost:3000/swagger-ui

See [QUICKSTART.md](QUICKSTART.md) for detailed guide.

## 📁 Project Structure

```
strategy_game/
├── backend/              # Rust backend
│   ├── src/
│   │   ├── types/       # utoipa-annotated types (source of truth)
│   │   ├── game/        # Game logic (state, combat, AI, map gen)
│   │   ├── websocket/   # WebSocket server
│   │   └── main.rs      # Server entry point
│   └── openapi.json     # Generated OpenAPI spec
│
├── frontend/            # TypeScript/React frontend
│   ├── src/
│   │   ├── api/        # AUTO-GENERATED SDK (types, models, services)
│   │   └── client/     # WebSocket client (uses generated types)
│   └── package.json
│
├── docs/               # Documentation
│   └── brief_expanded.md  # Full game design document
│
├── Makefile            # Build automation
├── QUICKSTART.md       # Getting started guide
├── SDK_SUMMARY.md      # SDK architecture details
└── README.md           # This file
```

## 🛠️ Tech Stack

### Backend
- **Rust** - Systems programming language
- **Axum** - Web framework
- **Tokio** - Async runtime
- **utoipa** - OpenAPI generation from Rust types
- **Serde** - Serialization/deserialization
- **WebSockets** - Real-time communication

### Frontend
- **TypeScript** - Type-safe JavaScript
- **React** - UI library
- **Vite** - Build tool
- **openapi-typescript-codegen** - SDK generation

## 📚 Documentation

- [QUICKSTART.md](QUICKSTART.md) - Get started in 5 minutes
- [backend/README.md](backend/README.md) - Backend architecture
- [frontend/SDK_README.md](frontend/SDK_README.md) - SDK usage guide
- [SDK_SUMMARY.md](SDK_SUMMARY.md) - Type safety pipeline details
- [docs/brief_expanded.md](docs/brief_expanded.md) - Complete game design

## 🎯 Key Commands

```bash
# SDK Generation
make sdk              # Export OpenAPI + Generate TypeScript SDK
make export-openapi   # Export OpenAPI spec only
make generate-sdk     # Generate SDK from existing spec

# Development
make backend          # Run Rust backend
make frontend         # Run React frontend
make dev             # Run both in parallel

# Utilities
make help            # Show all commands
make clean           # Clean build artifacts
```

## 🔧 SDK Usage Example

```typescript
import { useGameClient } from './client';

function Game() {
  const { client, gameState, isConnected } = useGameClient({
    autoConnect: true,
  });

  if (!isConnected) return <div>Connecting...</div>;

  return (
    <div>
      <button onClick={() => client?.attack(fromId, toId)}>
        Attack Territory
      </button>
      <div>Tick: {gameState?.tick}</div>
    </div>
  );
}
```

All types are auto-generated from backend - **zero manual type definitions!**

## 🎨 Game Mechanics

### Resources
- **Population**: Grows 10/sec per territory + terrain bonuses
- **Gold**: Generated by workers (1 per 10 workers/sec)
- **Troops**: Used for attacking (configurable ratio)
- **Workers**: Generate gold (1 - troop ratio)

### Combat
- Attack adjacent territories
- Combat formula based on troop ratios
- Terrain bonuses (Mountains: +30% defense)
- Building bonuses (Defense Post: +20% defense)

### Buildings
- **City**: +25,000 max population (1000 gold)
- **Defense Post**: +20% defense (500 gold)
- **Gold Mine**: +50% gold generation (750 gold)

### AI Personalities
- **Turtle**: Defensive, economic focus
- **Aggressor**: Constant attacks, high troops
- **Balanced**: Adapts to situation
- **Opportunist**: Attacks weak targets
- **Rusher**: All-in aggression

## 🧪 Development Workflow

### Backend Changes

```bash
# 1. Edit types in backend/src/types/
# 2. Verify compilation
cd backend && cargo check

# 3. Regenerate SDK
make sdk

# 4. Fix any TypeScript errors in frontend
```

TypeScript will show **exactly** what needs updating - no guessing!

## 🤝 Contributing

1. Backend types are source of truth (`backend/src/types/`)
2. Never edit `frontend/src/api/` (auto-generated)
3. Custom logic goes in `frontend/src/client/`
4. Run `make sdk` after any backend type changes
5. Ensure all TypeScript errors are fixed before committing

## 📊 Project Stats

- **Backend**: ~2000 lines of Rust
- **Frontend SDK**: Auto-generated from backend
- **Game Loop**: 100ms tick rate (10 ticks/second)
- **AI Count**: 8 opponents with 5 personality types
- **Territories**: 50-100 (configurable)
- **Build Time**: <30s backend, <5s frontend

## 🔐 Type Safety Guarantees

```typescript
// ❌ Compile error - invalid building type
client.buildStructure(id, 'invalid');

// ❌ Compile error - missing required field
const msg: ClientMessage = {
  type: 'attack',
  from: id,
  // Missing 'to' field
};

// ✅ Correct - fully typed
client.buildStructure(id, 'city');
client.attack(fromId, toId);
```

## 🐛 Troubleshooting

**Cannot find module './api/models'**
```bash
make sdk  # Generate SDK first
```

**Port 3000 in use**
```bash
lsof -ti:3000 | xargs kill -9
```

**Types don't match backend**
```bash
make sdk  # Regenerate SDK
```

## 📝 License

MIT

## 🎉 Next Steps

1. ✅ Backend with game logic
2. ✅ OpenAPI generation
3. ✅ TypeScript SDK generation
4. ✅ WebSocket client
5. ✅ React hooks
6. 🚧 Build game UI
7. 🚧 Add map visualization
8. 🚧 Implement territory clicking
9. 🚧 Add game controls UI

**Ready to build the frontend!** See [QUICKSTART.md](QUICKSTART.md) to get started.
# claudefront
